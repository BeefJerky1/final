<?xml version="1.0" encoding="UTF-8"?>
<!-- - mapper 파일은 특정 테이블에 대한 SQL 구문을 보관하는 파일이다. 
	- mybatis를 이용하는 개발자는 이곳에 저장된 SQL구문을 아이디를 이용해서 호출한다. 
	- 파일마다 동일한 아이디로 인해 발생하는 충돌을 방지하기 위한 고유한 namespace를 사용한다. 
	- 만약 namespace가 olympic이고 구문 아이디가 list라면 외부에서는 olympic.list로 호출한다. 
	- 일반적으로 namespace는 테이블명으로 한다. - mapper 내부에는 다음 종류 태그로 구문을 저장할 수 있다. 
		- <insert> 
		- <select> 
		- <update> 
		- <delete> 
	- 각 구문은 반드시 아이디를 가져야 한다. 
	- 각 구문에는 다음과 같은 속성을 작성할 수 있다. 
		- parameterType: 해당 구문이 실행되기 위해 필요한 데이터의 자료형을 적는다.(1개만 작성 가능) 
		- resultType: 해당 구문의 실행 결과를 변경하기 위한 자료형(1개만 작성 가능, 필수) 
	- 각 구문에는 데이터를 다음과 같이 바인딩 할 수 있다. 
		- 정적 바인딩 : ${이름} 형태로 작성하면 어떠한 추가 작업도 없이 해당 위치에 데이터가 그대로 작성된다
		- 동적 바인딩: #{이름} 형태로 작성하면 자동으로 자료형에 맞게 해당 데이터를 추출하여 작성해준다.(DTO변수명) -->
		
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="clubboard">
	<!-- 전체 목록 -->
	<select id="list" parameterType="int" resultType="clubBoardDto">
		select * from club_board where club_no = #{clubNo} order by club_board_no desc
	</select>
	<!-- 시퀀스 생성 -->
	<select id="sequence" resultType="int">
		select club_board_seq.nextval from dual
	</select>
	<!-- 게시글 등록 -->
	<insert id="insert" parameterType="clubBoardDto">
		insert into club_board (club_board_no, club_no, club_board_writer, club_board_content)
		values(#{clubBoardNo}, #{clubNo}, #{clubBoardWriter}, #{clubBoardContent})
	</insert>

	<!-- 삭제 -->
	<delete id="delete" parameterType="int">
		delete club_board where club_board_no = #{clubBoardNo}
	</delete>
	<!-- 수정 -->
	<update id="edit" parameterType="clubBoardDto">
		update club_board set club_board_content = #{clubBoardContent} where club_board_no = #{clubBoardNo}
	</update>
	<!--  댓글 카운트 -->
	<select id="calculateReplyCount" parameterType="int">
		select club_board_count from club_board
	</select>
	<select id="one" resultType="clubBoardDto" parameterType="int">
		select * from club_board where club_board_no = #{clubBoardNo}
	</select>
	
	<resultMap type="ClubBoardListItemVO" id="clubBoardListItem">
		<association property="clubBoardDto">
			<result column="club_board_no" property="clubBoardNo"/>
			<result column="club_no" property="clubNo"/>
			<result column="club_board_writer" property="clubBoardWriter"/>
			<result column="club_board_content" property="clubBoardContent"/>
			<result column="club_board_time" property="clubBoardTime"/>
 			<result column="club_board_count" property="clubBoardCount"/> 
		</association>
		
		<association property="memberDto">
			<result column="member_no" property="memberNo"/>
			<result column="member_email" property="memberEmail"/>
			<result column="member_pw" property="memberPw"/>
			<result column="member_nick" property="memberNick"/>
			<result column="member_gender" property="memberGender"/>
			<result column="member_mbti" property="memberMbti"/>
			<result column="member_animal" property="memberAnimal"/>
			<result column="member_interest1" property="memberInterest1"/>
			<result column="member_interest2" property="memberInterest2"/>
			<result column="member_interest3" property="memberInterest3"/>
			<result column="member_place1" property="memberPlace1"/>
			<result column="member_place2" property="memberPlace2"/>
			<result column="member_place3" property="memberPlace3"/>
			<result column="member_admin" property="memberAdmin"/>
			<result column="member_report_count" property="memberReportCount"/>
			<result column="member_club_count" property="memberClubCount"/>
			<result column="member_sns_id" property="memberSnsId"/>
			<result column="member_logindate" property="memberLogindate"/>
			<result column="member_birth" property="memberBirth"/>
			<result column="member_name" property="memberName"/>
		</association>
		<association property="clubBoardLikeDto">
			<result column="club_board_like_no" property="clubBoardLikeNo"/>
			<result column="member_no" property="memberNo"/>
			<result column="club_board_no" property="clubBoardNo"/>
			<result column="like_check" property="likeCheck"/>
		</association>
		<association property="memberProfileDto">
			<result column="member_no" property="memberNo"/>
			<result column="attach_no" property="attachNo"/>
		</association>
		
		<collection javaType="java.util.List" ofType="ClubboardAttachDto" property="ClubboardAttachDto" select="subListQuery" column="clubNo">
			<result column="club_board_no" property="clubBoardNo"/>
			<result column="club_no" property="clubNo"/>
			<result column="게시글사진번호" property="attachNo"/>
		</collection>
	</resultMap>
	
	<select id="clubBoardTotalList" resultMap="clubBoardListItem">
<!-- 	join된 구문 작성  -->
		select
	   C.club_board_no,
	   C.club_board_count,
       C.club_board_time, 
       C.club_board_content,
       C.club_no as,
       C.club_board_writer,
       M.member_no as,
       M.member_animal as,
       M.member_nick as,
       M.member_interest1,
       M.member_interest2,
       M.member_interest3,
       M.member_gender,
       M.member_place1,
       M.member_place2,
       M.member_place3,
       M.member_sns_id,
       M.member_logindate,
       P.attach_no  as 프로필사진번호,
       A.attach_no as 게시글사진번호,
       L.club_board_like_no,
       L.like_check
from club_board C 
left outer join member M 
   on C.club_board_writer = M.member_no 
left outer join member_profile P 
   on C.club_board_writer = P.member_no
left outer join club_board_like L
   on C.club_board_writer = L.member_no
 left outer join club_board_attach A 
   on C.club_board_No = A.club_board_no 
where C.club_no = #{clubNo}
	</select>
	<!-- 단일 조회 -->
<!-- 	<select id="one" resultMap="clubBoardListItem"> -->
<!-- 				select -->
<!-- 	   C.club_board_no, -->
<!-- 	   C.club_board_count, -->
<!--        C.club_board_time,  -->
<!--        C.club_board_content, -->
<!--        C.club_no as, -->
<!--        C.club_board_writer, -->
<!--        M.member_no as, -->
<!--        M.member_animal as, -->
<!--        M.member_nick as, -->
<!--        M.member_interest1, -->
<!--        M.member_interest2, -->
<!--        M.member_interest3, -->
<!--        M.member_gender, -->
<!--        M.member_place1, -->
<!--        M.member_place2, -->
<!--        M.member_place3, -->
<!--        M.member_sns_id, -->
<!--        M.member_logindate, -->
<!--        P.attach_no  as 프로필사진번호, -->
<!--        A.attach_no as 게시글사진번호, -->
<!--        H.heart_no, -->
<!--        H.like_check -->
<!-- from club_board C  -->
<!-- left outer join member M  -->
<!--    on C.club_board_writer = M.member_no  -->
<!-- left outer join member_profile P  -->
<!--    on C.club_board_writer = P.member_no -->
<!-- left outer join heart H  -->
<!--    on C.club_board_writer = H.member_no -->
<!--  left outer join club_board_attach A  -->
<!--    on C.club_board_No = A.club_board_no  -->
<!-- where C.club_board_No = #{clubBoardNo} -->
<!-- 	</select> -->
	<select id="subListQuery" resultType="ClubboardAttachDto" parameterType="int">
		select * from club_board_attach where club_no = #{clubNo}
	</select>

</mapper>