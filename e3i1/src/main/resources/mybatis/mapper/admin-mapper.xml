<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	
	<!-- 멤버 숫자 -->
	<select id="memberCount" resultType="int"> 
	select count(*) from  member
	</select>
	<!-- 멤버 목록 -->
	<select id="memberlist" resultType="memberDto" parameterType="Map"> 	
	select * from member order by ${column} ${order}
	</select>	
	<!-- 멤버 검색 -->
	<select id="membersearch" resultType="memberDto" parameterType="AdminSearchVO"> 
	<bind name="keywordExist" value="keyword!=null and type!=null and !keyword.equals('') and !type.equals('')" />
	
	select * from member
			<where>
			<!-- 아이디: 유사한 항목  -->
			<if test="keywordExist">
				and instr(${type}, #{keyword})>0
			</if>	
			<if test="column!=null and order !=null">
			order by ${column} ${order}
			</if>		
		</where>
	</select>
	<!-- 회원 삭제 -->
	<delete id="deleteMember" parameterType="int">
		delete member where member_no = #{memberNo}
	</delete>
	
	<!-- 회원정보 변경 -->
	<update id="changeMemberInformation" parameterType="MemberDto">
		update member 
			set
				member_name = #{memberName},
				member_Nick = #{memberNick}, member_email = #{memberEmail},
				member_gender = #{memberGender}, member_phone = #{memberPhone},
				member_sns_id = #{memberSnsId}, member_interest1 = #{memberInterest1},
				member_interest2 = #{memberInterest2}, member_interest3 = #{memberInterest3},
				member_place1 = #{memberPlace1}, member_place2 = #{memberPlace2}, member_place3 = #{memberPlace3}
			where
				member_no = #{memberNo}
	</update>
	<!-- 회원 상세 조회 -->
	<select id="oneMember" resultType="MemberDto" parameterType="int">
		select * from member where member_No = #{memberNo}
	</select>
	<!-- 회원 검색 -->
	<select id="findMember" resultType="memberDto" parameterType="AdminSearchVO">
	<!-- 		- bind를 사용하면 변수를 만들 수 있다. -->
		<bind name="keywordExist" value="keyword!=null and type!=null and !keyword.equals('') and !type.equals('')" />
		<!-- 전체 검색 -->
		select * from member
		<where>
			<!-- 아이디: 유사한 항목  -->
			<if test="keywordExist">
				and instr(member_no, #{keyword})>0
			</if>	
			<if test="column!=null and order !=null">
			order by ${column} ${order}
			</if>		
		</where>
	</select>
	<!-- 소모임 숫자 -->
	<select id="clubCount" resultType="int"> 
	select count(*) from  club
	</select>
	<!-- 소모임 목록 -->
	<select id="clublist" resultType="clubDto" parameterType="Map"> 	
	select * from club order by ${column} ${order}
	</select>	
	<!-- 소모임 검색 -->
	<select id="clubsearch" resultType="clubDto" parameterType="AdminSearchVO"> 
	<bind name="keywordExist" value="keyword!=null and type!=null and !keyword.equals('') and !type.equals('')" />
	select * from club
			<where>
			<!-- 아이디: 유사한 항목  -->
			<if test="keywordExist">
				and instr(${type}, #{keyword})>0
			</if>	
			<if test="column!=null and order !=null">
			order by ${column} ${order}
			</if>		
		</where>
	</select>
		<!-- 소모임 검색 -->
		
		<!-- 소모임 삭제 -->
	<delete id="deleteClub" parameterType="int">
		delete club where club_no = #{clubNo}
	</delete>
		<!-- 소모임 상세 조회 -->
	<select id="oneClub" resultType="clubDto" parameterType="int">
		select * from club where club_no = #{clubNo}
	</select>
		<!-- 소모임 정보 변경 -->
	<update id="changeClubInformation" parameterType="clubDto">
		update club 
			set
				club_name = #{clubName},
				club_leader = #{clubLeader}, 
				club_main_category = #{clubMainCategory}, club_sub_category = #{clubSubCategory},
				club_summary = #{clubSummary}, club_place = #{clubPlace},
				club_member_limit = #{clubMemberLimit}
			where
				club_no = #{clubNo}
	</update>
	<resultMap type="AdminClubVO" id="AdminClubVO">
		<association property="clubMemberDto">
			<result column="club_member_no" property="clubMemberNo"/>			
			<result column="club_no" property="clubNo"/>			
			<result column="member_no" property="memberNo"/>			
			<result column="club_member_date" property="clubMemberDate"/>			
			<result column="club_member_grade" property="clubMemberGrade"/>			
			<result column="club_member_answer1" property="clubMemberAnswer1"/>			
			<result column="club_member_answer2" property="clubMemberAnswer2"/>			
			<result column="club_member_answer3" property="clubMemberAnswer3"/>			
			<result column="club_member_permission" property="clubMemberPermission"/>			
			<result column="club_member_refuse_msg" property="clubMemberRefuseMsg"/>			
		</association>
		<association property="clubDto">
			<result column="club_no" property="clubNo"/>
			<result column="club_leader" property="clubLeader"/>
			<result column="club_name" property="clubName"/>
			<result column="club_summary" property="clubSummary"/>
			<result column="club_main_category" property="clubMainCategory"/>
			<result column="club_sub_category" property="clubSubCategory"/>
			<result column="club_place" property="clubPlace"/>
			<result column="club_join_question1" property="clubJoinQuestion1"/>
			<result column="club_join_question2" property="clubJoinQuestion2"/>
			<result column="club_join_question3" property="clubJoinQuestion3"/>
			<result column="club_member_limit" property="clubMemberLimit"/>
		</association>
		<association property="memberDto">
			<result column="member_no" property="memberNo"/>
			<result column="member_email" property="memberEmail"/>
			<result column="member_nick" property="memberNick"/>
			<result column="member_gender" property="memberGender"/>
			<result column="member_phone" property="memberPhone"/>
			<result column="member_birth" property="memberBirth"/>
			<result column="member_name" property="memberName"/>
			<result column="member_mbti" property="memberMbti"/>
			<result column="member_animal" property="memberAnimal"/>
			<result column="member_interest1" property="memberInterest1"/>
			<result column="member_interest2" property="memberInterest2"/>
			<result column="member_interest3" property="memberInterest3"/>
			<result column="member_place1" property="memberPlace1"/>
			<result column="member_place2" property="memberPlace2"/>
			<result column="member_place3" property="memberPlace3"/>
			<result column="member_admin" property="memberAdmin"/>
			<result column="member_report_count" property="memberReportCount"/>
			<result column="member_club_count" property="memberClubCount"/>
			<result column="member_sns_id" property="memberSnsId"/>
			<result column="member_logindate" property="memberLogindate"/>
		</association>
	</resultMap>
	<select id="clubMemberList" resultMap="AdminClubVO">
	 SELECT
			C.*,
			cm.*,
			m.MEMBER_GENDER,
			m.MEMBER_MBTI,
			m.MEMBER_ANIMAL,
			m.MEMBER_INTEREST1,
			m.MEMBER_INTEREST2,
			m.MEMBER_INTEREST3,
			m.MEMBER_PLACE1,
			m.MEMBER_PLACE2,
			m.MEMBER_PLACE3,
			m.MEMBER_SNS_ID,
			m.MEMBER_NICK,
			m.MEMBER_BIRTH 
		FROM 
			club_member cm 
		LEFT OUTER JOIN MEMBER m 
		ON cm.MEMBER_NO = m.MEMBER_NO 
		LEFT OUTER JOIN CLUB C
		ON cm.CLUB_NO = C.CLUB_NO
		WHERE CM.club_no = #{clubNo} and cm.club_member_permission =1
	</select>
	<select id="clubboardlist" resultType="clubBoardDto" parameterType="int">
		select * from club_board where club_no= #{clubNo}
	</select>
	<select id="clubreplylist" resultType="clubBoardReplyDto" parameterType="int">
		select * from club_board_reply where club_no= #{clubNo}
	</select>
	<!-- mbti 설문 목록 -->
	<select id="mbtisurveylist" resultType="mbtiSurveyDto">
		select * from mbti_survey order by survey_no asc
	</select>
	<!-- mbti 설문 수정 -->
	<update id="changeSurveyInformation" parameterType="mbtiSurveyDto">
		update mbti_survey
			set
				survey_question = #{surveyQuestion}, survey_answer1 = #{surveyAnswer1},
				survey_answer2 = #{surveyAnswer2} 
			where 
				survey_no = #{surveyNo}
	</update>
	<!-- mbti 설문 상세 -->
	<select id="oneSurvey" resultType="mbtiSurveyDto" parameterType="int">
		select * from mbti_survey where survey_no = #{surveyNo}
	</select>
	<!--mbti 설문 등록 -->
	<insert id="insert" parameterType="mbtiSurveyDto">
		insert into mbti_survey
			(survey_no, survey_question, survey_answer1, survey_answer2) 
			values
			(#{surveyNo}, #{surveyQuestion}, #{surveyAnswer1}, #{surveyAnswer2})
	</insert>
	<!--mbti 설문 삭제 -->
	<delete id="deleteSurvey" parameterType="int">
		delete mbti_survey where survey_no = #{SurveyNo}
	</delete>
	
	<!-- mbti 게시판 목록 -->
	<select id="mbtiboardlist" resultType="mbtiBoardDto">
		select * from mbti_board order by mbti_board_no asc
	</select>
</mapper>